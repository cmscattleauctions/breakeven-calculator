<!-- ✅ FILE 2: PATCH FOR YOUR EXISTING index.html
Copy/paste the THREE sections below into your current file:
1) HTML block (replace your current Interest Rate UI)
2) CSS block (add to your existing <style>)
3) JS block (add near the bottom, after your existing JS functions)
-->

<!-- =========================================================
1) HTML — REPLACE your current Interest Rate UI with this block
   IMPORTANT: this expects you already have an input with id="interestRate"
   If you do NOT, keep this <input id="interestRate" ...> as your main interest value.
========================================================= -->
<div class="field-group">
  <label class="field-label">Interest Rate</label>

  <!-- Preset buttons get rendered here -->
  <div class="segmented" id="interestPresetButtons"></div>

  <!-- Custom rate UI wrapper -->
  <div id="interestCustomWrap" class="custom-wrap" style="display:none;">
    <div class="custom-row">
      <span class="helper-text">Custom Interest Rate</span>
      <!-- This is your existing control. If you already have a wheel/stepper UI,
           keep it here. If not, this input works fine. -->
      <input id="interestRate" type="number" inputmode="decimal" step="0.01" class="field-input" />
      <span class="suffix">%</span>
    </div>
    <div class="helper-text subtle">Tip: Presets are editable in <strong>config.json</strong>.</div>
  </div>
</div>


<!-- =========================================================
2) CSS — ADD this to your existing <style> section
========================================================= -->
<style>
  .segmented{
    display:grid;
    grid-template-columns:repeat(4,1fr);
    gap:8px;
    margin-top:8px;
  }
  .seg-btn{
    padding:10px 8px;
    border-radius:12px;
    border:1px solid rgba(0,0,0,0.14);
    background:#fff;
    font-weight:700;
    cursor:pointer;
    line-height:1;
  }
  .seg-btn.active{
    background:#336699;
    border-color:#336699;
    color:#fff;
  }
  .custom-wrap{
    margin-top:10px;
    padding:10px;
    border:1px solid rgba(0,0,0,0.10);
    border-radius:12px;
    background:rgba(51,102,153,0.04);
  }
  .custom-row{
    display:flex;
    align-items:center;
    gap:10px;
  }
  .helper-text{
    font-size:12px;
    font-weight:600;
  }
  .helper-text.subtle{
    margin-top:8px;
    font-weight:500;
    opacity:0.75;
  }
  .suffix{
    font-weight:700;
    opacity:0.7;
  }
</style>


<!-- =========================================================
3) JS — ADD this near the bottom of your file (after your existing JS)
   This:
   - loads presets from ./config.json
   - renders 3 preset buttons + Custom
   - Custom starts at the "middle" preset (default: 6.75)
   - calls your calculator’s recompute function automatically
========================================================= -->
<script>
  // ---- Config defaults (used if config.json is missing) ----
  let CMS_CONFIG = {
    interestRatePresets: [6.25, 6.75, 7.25],
    defaultPresetIndex: 1
  };

  // Call whichever recompute function your calculator already uses
  function triggerRecalc() {
    try {
      if (typeof window.recalc === "function") return window.recalc();
      if (typeof window.recalculate === "function") return window.recalculate();
      if (typeof window.calculateBreakeven === "function") return window.calculateBreakeven();
      // If none found, do nothing—no crash.
    } catch (e) {}
  }

  async function loadCmsConfig() {
    try {
      const res = await fetch("./config.json", { cache: "no-store" });
      if (!res.ok) return;
      const json = await res.json();
      // Shallow merge, keep defaults as fallback
      CMS_CONFIG = { ...CMS_CONFIG, ...json };
    } catch (e) {
      // ignore; defaults remain
    }
  }

  function setSelectedButton(wrapEl, labelText) {
    wrapEl.querySelectorAll("button.seg-btn").forEach(btn => {
      btn.classList.toggle("active", btn.dataset.label === labelText);
    });
  }

  function renderInterestPresets() {
    const wrap = document.getElementById("interestPresetButtons");
    const customWrap = document.getElementById("interestCustomWrap");
    const interestInput = document.getElementById("interestRate");

    if (!wrap) return;

    const presets = Array.isArray(CMS_CONFIG.interestRatePresets)
      ? CMS_CONFIG.interestRatePresets
      : [6.25, 6.75, 7.25];

    // “Middle” preset for custom default
    const middlePreset = presets[Math.floor(presets.length / 2)] ?? 6.75;

    wrap.innerHTML = "";

    function makeBtn(label, onClick) {
      const b = document.createElement("button");
      b.type = "button";
      b.className = "seg-btn";
      b.textContent = label;
      b.dataset.label = label;
      b.addEventListener("click", onClick);
      return b;
    }

    // Preset buttons
    presets.forEach((rate) => {
      const label = `${Number(rate).toFixed(2)}%`;
      wrap.appendChild(makeBtn(label, () => {
        setSelectedButton(wrap, label);
        if (customWrap) customWrap.style.display = "none";
        if (interestInput) interestInput.value = Number(rate).toFixed(2);
        triggerRecalc();
      }));
    });

    // Custom button
    wrap.appendChild(makeBtn("Custom", () => {
      setSelectedButton(wrap, "Custom");
      if (customWrap) customWrap.style.display = "block";

      // Start custom at middle preset if empty or invalid
      if (interestInput) {
        const current = parseFloat(interestInput.value);
        if (!Number.isFinite(current)) {
          interestInput.value = Number(middlePreset).toFixed(2);
        }
        // If you have a “scroll wheel init” function, call it here:
        // if (typeof window.initInterestWheel === "function") window.initInterestWheel(parseFloat(interestInput.value));
      }

      triggerRecalc();
    }));

    // Default selection: config defaultPresetIndex, else middle
    let idx = Number.isInteger(CMS_CONFIG.defaultPresetIndex)
      ? CMS_CONFIG.defaultPresetIndex
      : Math.floor(presets.length / 2);
    idx = Math.max(0, Math.min(idx, presets.length - 1));

    const defaultRate = presets[idx];
    const defaultLabel = `${Number(defaultRate).toFixed(2)}%`;

    setSelectedButton(wrap, defaultLabel);
    if (customWrap) customWrap.style.display = "none";
    if (interestInput) interestInput.value = Number(defaultRate).toFixed(2);

    // When user changes the custom input manually, keep it in sync and recalc
    if (interestInput) {
      interestInput.addEventListener("input", () => {
        // If they type while Custom is open, just recalc.
        triggerRecalc();
      });
    }
  }

  document.addEventListener("DOMContentLoaded", async () => {
    await loadCmsConfig();
    renderInterestPresets();
    triggerRecalc();
  });
</script>
